---
- name: Nokia SR OS Streaming Telemetry
  gather_facts: false
  hosts: nokia_srsim

  vars:
    ansible_connection: nokia.openconfig.gnmi

  tasks:
  - name: gNMI streaming telemetry
    nokia.openconfig.gnmi_subscribe:
      duration: 5
      prefix: /state
      mode: STREAM
      subscription:
        - path: /port[port-id=1/1/c1/1]/ethernet/statistics
          mode: SAMPLE
          sampleInterval: '1000000000'
        - path: /router[router-name=Base]/interface/statistics
          mode: SAMPLE
          sampleInterval: '1000000000'
    register: testout

  - name: dump test output
    debug:
      msg: |
        {{ testout.output | from_json }}
