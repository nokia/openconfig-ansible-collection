---
- name: Nokia SRL Streaming Telemetry over gNMI
  gather_facts: false
  hosts: all

  vars:
    ansible_connection: nokia.openconfig.gnmi

  tasks:
  - name: gNMI streaming telemetry
    nokia.openconfig.gnmi_subscribe:
      duration: 5
      mode: STREAM
      subscription:
        - path: /oc:interfaces/interface[name=*]/state/counters
          mode: SAMPLE
          sampleInterval: '1000000000'
    register: testout

  - name: dump test output
    debug:
      msg: |
        {{ testout.output }}