---
- name: gNMI SET/GET demo for Nokia SROS
  gather_facts: false
  hosts: nokia_srsim

  vars:
    ansible_connection: nokia.openconfig.gnmi

  tasks:
  - name: Get Nodal Configuration (Selective Branches)
    nokia.openconfig.gnmi_get:
      type: CONFIG
      prefix: /configure
      path:
        - system/location
        - system/contact
        - service/md-auto-id
        - port[port-id=1/1/1]
    register: testout

  - name: dump test output
    debug:
      msg: '{{ testout.output }}'

  - name: Update Nodal Configuration (using gNMI SET)
    nokia.openconfig.gnmi_config:
      prefix: configure
      update:
        - path: system/location
          val: Australia
        - path: system/contact
          val: NOKIA
      replace:
        - path: service/md-auto-id
          val:
            service-id-range:
              start: 10000
              end: 99999
            customer-id-range:
              start: 10000
              end: 10999
      delete:
        - system/cron
    register: testout

  - name: dump test output
    debug:
      msg: |
        {{ testout.output }}
